---
title: "Spatio-Temporal Distribution of Atlantic Menhaden"
author: "Janelle L. Morano"
date: "`r Sys.Date()`"
output: bookdown::pdf_document2
fig_caption: yes
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Abstract

Marine species are responding to dramatic changes in the marine environment caused by climate change through adaptation, mortality, or movement. The challenge is to understand current species distributions and to make accurate forecasts to adapt our management and planning practices under future seascape scenarios (e.g., climate change scenarios, offshore wind development). Using a spatially-explicit species distribution models (SDMs) that account for unmeasured variables and processes (i.e. latent variables or random effects) can reveal the underlying ecosystem processes and dynamics, reduce the bias in existing population models, and improve the accuracy of forecasting distributions. These models can also be used to explore and address situations where species may not be appropriately captured by a fixed survey, either temporally or spatially, as a result of a changing ecosystem. For example, species movements to deeper waters, latitudinal shifts outside a survey region, or shifts in the timing of seasonal migrations. Forage fish (juvenile fish and small pelagic fishes) are important prey for large pelagic and protected species; their populations are sensitive to environmental conditions, but their spatial distributions are often overlooked. Using Atlantic menhaden, <i>Brevoortia tyrannus</i>, as a case study, we assessed the spatio-temporal distribution of menhaden along the US east coast using multiple fisheries-independent surveys (NEFSC, NEAMAP) on depth and bottom temperature in the vector autoregressive spatio-temporal (VAST) model. 

Not yet done: We compared to other modeling architectures (e.g., R-INLA) and considered trade-offs in model architecture and different surveys to the spatio-temporal predictions at various scales. We evaluated options for alternative sampling designs and modeling architectures to support adaptive management strategies and future planning efforts.

# Main Results
```{r distribution, echo=FALSE, message=FALSE, fig.align="center", fig.cap= "The distribution of sampled menhaden in the NEFSC bottom trawl surveys, 1963-2019, and the NEAMAP bottom trawl surveys, 2007-2020. Note that recent years are plotted on top of past years, which may obscure contractions or expansions of the range in past years."}
library (tidyverse)
library(sp)
library (rnaturalearth)
library (rnaturalearthdata)
library(viridis)

data <- read.csv("/Users/janellemorano/DATA/Atlantic_menhaden_modeling/menhaden_sampledata.csv", header = TRUE)

# Create basemap
world <- ne_countries(scale = "medium", returnclass = "sf")  

# Plot menhaden spatial distribution from survey data
ggplot(data = world) +
  geom_sf() +
  coord_sf (xlim = c(-83,-60), ylim = c (25,48), expand = FALSE ) +
  geom_point(data = data,
             aes (x = Longitude, y = Latitude, color = Year)) + 
  scale_color_continuous(type = "viridis") +
  scale_fill_viridis() +
  theme_bw() +
  theme (axis.text = element_blank()) +
  xlab("longitude") + 
  ylab("latitude")

```


![**(#fig:dist) Estimated spatio-temporal distribution of Atlantic menhaden, 2007-2019, in Spring. Blue = 0-low abundance, red = high abundance.**](/Users/janellemorano/MODEL_OUTPUT/menhaden_2007-2019_bottempdepth_spring/spring_ln_density-predicted.png) 

![**(#fig:dist) Estimated spatio-temporal distribution of Atlantic menhaden, 2007-2019, in Fall. Blue = 0-low abundance, red = high abundance.**](/Users/janellemorano/MODEL_OUTPUT/menhaden_2007-2019_bottempdepth_fall/fall_ln_density-predicted.png)

# VAST Model Setup
```{r, eval=F, echo=T}
# Model Settings
####################
settings = make_settings( n_x = 350, 
                          Region = 'User', 
                          purpose = "index2", 
                          #strata.limits = example$strata.limits, #this was in the simple model example but not sure how it would interface here with a user-defined grid
                          knot_method = 'grid', #must be 'samples' or 'grid'
                          ObsModel= c(2,0), #1st value catch rate= gamma = 2; 2nd value encounter probabilities= 0 default log-link,
                          use_anisotropy=FALSE,
                          bias.correct = FALSE,
                          fine_scale=TRUE )

# Covariate Settings
####################
## Depth AND Bottom Temperature
covariate_data.spring$DepthScale = covariate_data.spring$Depth / 100
covariate_data.fall$DepthScale = covariate_data.fall$Depth / 100
# Define formula for Depth
X1_formula = ~ bs( log(DepthScale), degree=2, intercept=FALSE)
# Define formula for Bottom Temp
X2_formula = ~ bs( log(Bottemp), degree=2, intercept=FALSE)

# Fit the model
####################
# The same model is run for each season (Spring, Fall)
fit.spring = fit_model( "settings" = settings,
                 "Lat_i" = data.spring$Latitude,
                 "Lon_i" = data.spring$Longitude,
                 "t_i" = data.spring$Year, #time
                 "b_i" = data.spring$Weight, #catch
                 "a_i" = data.spring$Areasw, #area swept
                 "v_i"= data.spring$Cruise,
                 "X1_formula" = X1_formula, #depth
                 "X2_formula" = X2_formula, #bottemp
                 "covariate_data" = covariate_data.spring,
                 "input_grid" = user_region)
```

